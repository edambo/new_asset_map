{
  "hash": "cd980c3b1b9f62ef5bf4a60b94d7fd9d",
  "result": {
    "engine": "knitr",
    "markdown": "# Purpose\nThe purpose of this file is to ensure the data provided by United Way is in the appropriate format for\ncreating the dashboard in a visually appealing and meaningful way.\n\n# Load Libraries\n\n\n\n\n# Load data and custom functions\n\n\n\n\n# Clean Data\n## Select relevant columns from each dataset\n### agency\n\n::: {.cell}\n\n```{.r .cell-code}\nagency <- uw_agency %>% \n  select(agency_id, contains(\"name\"), contains(\"aka\"), contains(\"description\"), \n         contains(\"websiteurl\"), (contains(\"address\") & \n                                    (matches(\"_[0-9]\") | contains(\"_city\") |\n                                       contains(\"_county\") | contains(\"_state\")|\n                                       contains(\"_zip\") | contains(\"_country\") |\n                                       contains(\"_notes\") | contains(\"itude\")) &\n                                    !(matches(\"international\") | \n                                        matches(\"mailing\"))),\n         contains(\"_ada_acccess\"), agency_option_irs_status\n                               ) %>%\n  # Rename columns to remove \"agency_addressus\" prefix\n  rename_with(~gsub(\"agency_addressus_\", \"\", .),\n              everything()) %>%\n    # Remove \"system\" from column names\n  rename_with(~gsub(\"_system\", \"\", .),\n              everything()) %>%\n  mutate(\n    # Remove square bracket and quotation marks\n    agency_option_irs_status = gsub(\"[^a-zA-Z0-9 -]\", \"\", agency_option_irs_status)\n  )\n```\n:::\n\n\n### service\n\n::: {.cell}\n\n```{.r .cell-code}\nservice <- uw_service %>%\n  select(agency_id, service_id, service_site_service_site, service_system_name, \n         service_system_aka, service_system_description, \n         service_system_coverage_area_text, service_system_fee_structure, \n         service_custom_eligibility, service_custom_languages_offered, \n         (contains(\"option\") & !(contains(\"record_owner\") | contains(\"days\"))), \n         service_status\n         ) %>%\n  rowwise() %>%\n  # Separate the site IDs\n  mutate(\n    site_id = paste(str_extract_all(service_site_service_site, \"[0-9]+\", simplify = TRUE), \n                        collapse = \", \"),\n    site_id = case_when(\n      site_id == \"NA\" ~ NA,\n      site_id == \"\"   ~ NA,\n      TRUE            ~ site_id\n    )\n  ) %>% \n  relocate(site_id, .after = \"service_site_service_site\") %>%\n  # Create individual rows for each site_id\n  tidyr::separate_longer_delim(site_id, delim = \", \") %>%\n  # Remove \"system\" from column names\n  rename_with(~gsub(\"_system\", \"\", .),\n              everything()) %>% \n  # Filter out inactive\n  filter(\n    !str_detect(service_option_status, regex(\"inactive\", ignore_case = TRUE))\n    ) %>%\n  filter(\n    !str_detect(service_name, regex(\"inactive\", ignore_case = TRUE))\n    )\n```\n:::\n\n\n### site\n\n::: {.cell}\n\n```{.r .cell-code}\nsite <- uw_site %>% \n  select(site_id, site_system_name, contains(\"aka\"), \n         contains(\"description\"), contains(\"websiteurl\"), (contains(\"address\") & \n                                    (matches(\"_[0-9]\") | contains(\"_city\") |\n                                       contains(\"_county\") | contains(\"_state\")|\n                                       contains(\"_zip\") | contains(\"_country\") |\n                                       contains(\"_notes\") | contains(\"itude\")) &\n                                    !(matches(\"international\") | \n                                        matches(\"mailing\"))),\n         contains(\"_ada_acccess\")\n                               ) %>%\n  # Rename columns to remove \"agency_addressus\" prefix\n  rename_with(~gsub(\"^(site_addressus_)\", \"\", .),\n              everything())%>%\n  # Remove \"system\" from column names\n  rename_with(~gsub(\"_system\", \"\", .),\n              everything())  \n```\n:::\n\n\n## Merge the datasets\n#### Filter services with site IDs\n\n::: {.cell}\n\n```{.r .cell-code}\nhas_site_id <- service %>% filter(!is.na(site_id))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nuw_data_site_id <- agency %>% filter(agency_id %in% has_site_id$agency_id) %>% \n  right_join(has_site_id, by = \"agency_id\") %>% \n  left_join(site, by = \"site_id\")\n```\n:::\n\n\n#### Filter services without site IDs and merge with agency data\n\n::: {.cell}\n\n```{.r .cell-code}\nno_site_id <- service %>% filter(is.na(site_id))\n\nno_site_id <-  agency %>% filter(agency_id %in% no_site_id$agency_id) %>% right_join(no_site_id, by = \"agency_id\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nuw_data <- bind_rows(uw_data_site_id, no_site_id)\n```\n:::\n\n\n## Classify the programs\n### Aggregate lines for each agency\n\n\n::: {.cell}\n\n```{.r .cell-code}\nuw_data_select <- uw_data %>% \n  select(agency_id, service_id, site_id, agency_name,  agency_aka, \n         agency_description, service_name, service_aka, zip,\n         service_description\n         ) %>% distinct()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nuw_data_c <- uw_data_select %>% \n  group_by(service_id) %>%\n  # Combine row values in a group\n  mutate(\n    across(\n      .cols = c(agency_name, #agency_description, \n                service_name, service_aka,\n         service_description),\n      .fns = ~as.list(str_split(paste(.x, collapse = \",\", sep = \"\"), \",\")[1])\n    )\n  ) %>% distinct() %>%\n  # Convert lists in each row  to strings\n  mutate(\n    across(\n      .cols = c(agency_name, #agency_description, \n                service_name, service_aka,\n         service_description),\n      .fns = ~list(unique(unlist(.x)))        \n    )\n  ) %>% \n  rowwise() %>% \n  # Convert lists in each row  to strings\n  mutate(\n    across(\n      .cols = c(agency_name, #agency_description, \n                service_name, service_aka,\n         service_description),\n      .fns = ~paste(unlist(.x), collapse = \" \")        \n    )\n  ) %>%\n  mutate(\n   agency_id,\n    c_text = paste(unlist(agency_name), # unlist(agency_description),\n                   unlist(service_name), unlist(service_aka), unlist(service_description),\n                   collapse = \" \")\n    ) %>% \n  ungroup() %>%\n  select(agency_id, service_id, site_id, agency_name, service_name, c_text) %>% distinct() \n```\n:::\n\n\n### Create columns for keyword match counts\n\n::: {.cell}\n\n```{.r .cell-code}\n# mil_keywords, wm_keywords, child_keywords,\n# dis_keywords, ani_keywords, imm_keywords, eld_keywords, dabi_keywords\n\nuw_data_classify <- uw_data_c %>% rowwise() %>%\n  mutate(\n    bhs_count = match_count(bhs_keywords, c_text),\n    sut_count = match_count(sut_keywords, c_text),\n    ha_count = match_count(ha_keywords, c_text),\n    hcs_count = match_count(hcs_keywords, c_text),\n    cpi_count = match_count(cpi_keywords, c_text),\n    laa_count = match_count(laa_keywords, c_text),\n    lds_count = match_count(lds_keywords, c_text),\n    res_count = match_count(res_keywords, c_text),\n    cea_count = match_count(cea_keywords, c_text),\n    inc_count = match_count(inc_keywords, c_text),\n    fa_count = match_count(fa_keywords, c_text),\n    mil_count = match_count(mil_keywords, c_text),\n    wm_count = match_count(wm_keywords, c_text),\n    child_count = match_count(child_keywords, c_text),\n    dis_count = match_count(dis_keywords, c_text),\n    ani_count = match_count(ani_keywords, c_text),\n    imm_count = match_count(imm_keywords, c_text),\n    eld_count = match_count(eld_keywords, c_text),\n    dabi_count = match_count(dabi_keywords, c_text),\n    bn_count = match_count(bn_keywords, c_text)\n  ) %>%\n  mutate(\n    across(\n      .cols = c(ends_with(\"count\")),\n      .fns = ~ case_when(\n        .x == 0         ~ \"Not likely\",\n        .x == 1         ~ \"Possibly\",\n        .x > 1          ~ \"Likely\"\n        ),\n      .names = \"{col}_likelihood\"\n    )\n  ) %>% \n  rename_with(\n    ~gsub(\"_count\", \"\", .),\n              ends_with(\"likelihood\")\n  ) %>% \n  # Count keyword matches only within agency names\n  mutate(\n    a_name_bhs_count = match_count(bhs_keywords, agency_name),\n    a_name_sut_count = match_count(sut_keywords, agency_name),\n    a_name_ha_count = match_count(ha_keywords, agency_name),\n    a_name_hcs_count = match_count(hcs_keywords, agency_name),\n    a_name_cpi_count = match_count(cpi_keywords, agency_name),\n    a_name_laa_count = match_count(laa_keywords, agency_name),\n    a_name_lds_count = match_count(lds_keywords, agency_name),\n    a_name_res_count = match_count(res_keywords, agency_name),\n    a_name_cea_count = match_count(cea_keywords, agency_name),\n    a_name_inc_count = match_count(inc_keywords, agency_name),\n    a_name_fa_count = match_count(fa_keywords, agency_name),\n    a_name_mil_count = match_count(mil_keywords, agency_name),\n    a_name_wm_count = match_count(wm_keywords, agency_name),\n    a_name_child_count = match_count(child_keywords, agency_name),\n    a_name_dis_count = match_count(dis_keywords, agency_name),\n    a_name_ani_count = match_count(ani_keywords, agency_name),\n    a_name_imm_count = match_count(imm_keywords, agency_name),\n    a_name_eld_count = match_count(eld_keywords, agency_name),\n    a_name_dabi_count = match_count(dabi_keywords, agency_name),\n    a_name_bn_count = match_count(bn_keywords, agency_name)\n  ) %>%\n  select(sort(names(.)))\n```\n:::\n\n\n# Load data filtered by Reyda\nReyda filtered out data. She removed agency IDs with counties outside Travis county as well as resources that appear to be niche population e.g child services, casa, emergency response, senior care, newspapers, event centers, cultural centers etc \n\n::: {.cell}\n\n```{.r .cell-code}\n# RT Filtered United Way Data\nrt_uw_class <- readxl::read_xlsx(\n  here::here(\"data\", \"uw_class_data_rt.xlsx\"),\n  sheet = \"sorted_filtered\") %>%\n  clean_names() %>% remove_empty(\"cols\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNew names:\n• `COUNT TOTAL FOR KEY CATEGORIES` -> `COUNT TOTAL FOR KEY CATEGORIES...26`\n• `COUNT TOTAL FOR KEY CATEGORIES` -> `COUNT TOTAL FOR KEY CATEGORIES...27`\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nrt_uw_cl <- uw_data_classify %>% \n  # Filter agency IDs in Reyda's list\n  filter(agency_id %in% rt_uw_class$agency_id)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter cases where at least one agency name categorical variable is > 0\nrt_a_name_cat <-  rt_uw_cl %>% \n  filter(if_any(\n  .cols = starts_with(\"a_name_\"), \n  .fns = ~.x > 0)) %>%\n  mutate(\n    bhs_cat = case_when(bhs_count > 2 | a_name_bhs_count != 0 ~ \"Behavioral Health Services\",\n                        TRUE                         ~ NA), \n    sut_cat = case_when(sut_count > 2 | a_name_sut_count != 0 ~ \"Substance Use Treatment\",\n                        TRUE                         ~ NA), \n    ha_cat = case_when(ha_count > 2 | a_name_ha_count != 0 ~ \"Housing Assistance\",\n                       TRUE                         ~ NA),\n    hcs_cat = case_when(hcs_count > 2 | a_name_hcs_count != 0 ~ \"Healthcare Services\",\n                       TRUE                         ~ NA),\n    cpi_cat = case_when(cpi_count > 2 | a_name_cpi_count != 0 ~ \"Community Policing Initiatives\",\n                        TRUE                         ~ NA),\n    laa_cat = case_when(laa_count > 2 | a_name_laa_count != 0 & \n                          (inc_likelihood == \"Likely\" | \n                             inc_likelihood == \"Possibly\") ~ \"Legal Aid and Advocacy\",\n    TRUE                         ~ NA),\n    lds_cat = case_when(lds_count > 2 | a_name_lds_count != 0 ~ \"Legal Diversion Services\",\n                        TRUE    ~ NA),\n    res_cat = case_when((res_count > 2 | a_name_res_count != 0) |\n                          (fa_count > 2 | a_name_fa_count != 0) |\n                          (bn_count > 2 | a_name_bn_count != 0) ~ \"Reentry Support\",\n                        TRUE ~ NA),\n    cea_cat = case_when(cea_count > 2 | a_name_cea_count != 0 & \n                          (inc_count > 2) ~ \"Community Engagement and Awareness\",\n                        TRUE ~ NA) \n  ) %>% unite(col =  \"main_categories\",\n              ends_with(\"_cat\"),\n              sep = \", \",\n              na.rm = TRUE) %>%\n  relocate(c_text, .after = \"agency_name\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Account for categories that don't make sense without incarcerated and add column that has all categories in a list.\nrt_uw_cat <- rt_uw_cl %>% \n  # Filter agency IDs not in Reyda's list\n  filter(!(agency_id %in% rt_a_name_cat$agency_id)) %>%\n  mutate(\n    bhs_cat = case_when(bhs_likelihood == \"Likely\" ~ \"Behavioral Health Services\",\n                        TRUE                         ~ NA), \n    sut_cat = case_when(sut_likelihood == \"Likely\" ~ \"Substance Use Treatment\",\n                        TRUE                         ~ NA), \n    ha_cat = case_when(ha_likelihood == \"Likely\" ~ \"Housing Assistance\",\n                       TRUE                         ~ NA),\n    hcs_cat = case_when(hcs_likelihood == \"Likely\" ~ \"Healthcare Services\",\n                       TRUE                         ~ NA),\n    cpi_cat = case_when(cpi_likelihood == \"Likely\" ~ \"Community Policing Initiatives\",\n                        TRUE                         ~ NA),\n    laa_cat = case_when((laa_likelihood == \"Possibly\" | \n                          laa_likelihood == \"Likely\") & \n                          (inc_likelihood == \"Likely\" | \n                             inc_likelihood == \"Possibly\") ~ \"Legal Aid and Advocacy\",\n    TRUE                         ~ NA),\n    lds_cat = case_when(lds_likelihood == \"Possibly\" | \n                          lds_likelihood == \"Likely\" ~ \"Legal Diversion Services\",\n                        TRUE    ~ NA),\n    res_cat = case_when((res_likelihood == \"Possibly\" | \n                          res_likelihood == \"Likely\" | fa_likelihood == \"Likely\" |\n                          bn_likelihood == \"Likely\") ~ \"Reentry Support\",\n                        TRUE ~ NA),\n    cea_cat = case_when((cea_likelihood == \"Possibly\" | \n                          cea_likelihood == \"Likely\") & \n                            (inc_likelihood == \"Likely\" | inc_likelihood == \"Possibly\") ~ \n      \"Community Engagement and Awareness\",\n      TRUE ~ NA) \n  ) %>% unite(col =  \"main_categories\",\n              ends_with(\"_cat\"),\n              sep = \", \",\n              na.rm = TRUE) %>%\n  relocate(c_text, .after = \"agency_name\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncombine_results <- rbind(rt_a_name_cat, rt_uw_cat) %>% select(c(agency_id, service_id, \n                                                          site_id, agency_name, \n                                                          service_name, \n                                                          ends_with(\"_cat\"), \n                                                          main_categories)) %>% \n  distinct()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal_cat <- uw_data %>% select(c(site_id, service_id, agency_description, site_addressus_zip,\n         service_description)) %>% distinct() %>% right_join(combine_results, by = c(\"service_id\", \"site_id\")) %>% distinct()\n\nfinal_cat %>% select(service_name) %>% distinct() %>% nrow()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 799\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntest <- c()\nfor (i in bhs_keywords){\n  t <- str_match(uw_data_classify$c_text[108], i)\n  test <- append(test, t)\n}\n\ntest\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA\n```\n\n\n:::\n:::\n\n\n\n# Adjust thresholds for blank categories\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncheck_list <- final_cat %>% group_by(agency_id) %>%\n  filter(main_categories == \"\") %>%\n  ungroup()\n\ncheck_list_key <- check_list %>% select(service_id, site_id)\n  \ncheck <- uw_data_classify %>% right_join(check_list_key, by = c(\"service_id\", \"site_id\")) %>%\n  mutate(\n    bhs_cat = case_when(bhs_count > 1 ~ \"Behavioral Health Services\",\n                        TRUE                         ~ NA), \n    sut_cat = case_when(sut_count > 1 ~ \"Substance Use Treatment\",\n                        TRUE                         ~ NA), \n    ha_cat = case_when(ha_count > 1 ~ \"Housing Assistance\",\n                       TRUE                         ~ NA),\n    hcs_cat = case_when(hcs_count > 1 ~ \"Healthcare Services\",\n                       TRUE                         ~ NA),\n    cpi_cat = case_when(cpi_count > 1 ~ \"Community Policing Initiatives\",\n                        TRUE                         ~ NA),\n    laa_cat = case_when((laa_count > 1) & \n                          (inc_count > 1) ~ \"Legal Aid and Advocacy\",\n    TRUE                         ~ NA),\n    lds_cat = case_when(lds_count > 1 ~ \"Legal Diversion Services\",\n                        TRUE    ~ NA),\n    res_cat = case_when((res_count  > 1 | fa_count > 1 |\n                          bn_count > 1) ~ \"Reentry Support\",\n                        TRUE ~ NA),\n    cea_cat = case_when((cea_count > 1) & \n                            (inc_count > 1) ~ \n      \"Community Engagement and Awareness\",\n      TRUE ~ NA) \n  ) %>% unite(col =  \"main_categories\",\n              ends_with(\"_cat\"),\n              sep = \", \",\n              na.rm = TRUE) %>%\n  relocate(c_text, .after = \"agency_name\") %>% \n  select(agency_id, service_id, site_id, agency_name, service_name, main_categories)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchecked <- readxl::read_xlsx(here::here(\"data\", \"check_united_way_data.xlsx\")) %>%\n  select(site_id, service_id, main_categories)\n```\n:::\n\n\n## Combine manually filled categories to remaining data\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal_cat_no_manual <- check_list <- final_cat %>% group_by(agency_id) %>%\n  filter(!main_categories == \"\") %>%\n  ungroup()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nchecked_full <- check_list %>% select(-c(main_categories)) %>%\n  right_join(checked, by = c(\"site_id\", \"service_id\"))\n```\n:::\n\n\nNote: Some rows containing less relevant resources were removed during manual review.\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal_cat_main <- rbind(final_cat_no_manual, checked_full) %>%\n# Remove irrelevant immigrant resources\nfilter(!grepl(\"38948|42055\", service_id)) %>%\n   tidyr::separate_longer_delim(main_categories, delim = \", \")\nid <- c(1:nrow(final_cat_main))\n\nfinal_cat_main <- cbind(id, final_cat_main)\n```\n:::\n\n\n### Identify Services with missing zip code data\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal_cat_no_zip <- final_cat_main %>% filter(is.na(site_addressus_zip))\n```\n:::\n\n\n### Filter only services with zip code data\n\n::: {.cell}\n\n```{.r .cell-code}\nfinal_cat_zip <- final_cat_main %>% filter(!is.na(site_addressus_zip))\n```\n:::\n\n\n### Data with and without zipcode combined\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwritexl::write_xlsx(final_cat_main, here::here(\"data\", \"uw_categorized_main_category.xlsx\"))\n```\n:::\n\n \n# Sub category classification\n## Behavioral Health Services\n\n::: {.cell}\n\n```{.r .cell-code}\nbhs_main <- final_cat_main %>% filter(main_categories == \"Behavioral Health Services\") %>%\n  ungroup() %>%\n  group_by(service_id) %>%\n  # Combine row values in a group\n  mutate(\n    across(\n      .cols = c(service_name, service_description),\n      .fns = ~as.list(str_split(paste(.x, collapse = \",\", sep = \"\"), \",\")[1])\n    )\n  ) %>% distinct() %>%\n  # Convert lists in each row  to strings\n  mutate(\n    across(\n      .cols = c(service_name, service_description),\n      .fns = ~list(unique(unlist(.x)))        \n    )\n  ) %>% \n  rowwise() %>% \n  # Convert lists in each row  to strings\n  mutate(\n    across(\n      .cols = c(service_name, service_description),\n      .fns = ~paste(unlist(.x), collapse = \" \")        \n    )\n  ) %>%\n  mutate(\n   agency_id,\n    c_text = paste(unlist(service_name), unlist(service_description),\n                   collapse = \" \")\n    ) %>% \n  # ungroup() %>% distinct() %>%\n  mutate(\n    cip_count = match_count(crisis_keywords, c_text),\n    emc_count = match_count(emergency_keywords, c_text),\n    res_count = match_count(res_keywords, c_text),\n    out_count = match_count(outpatient_keywords, c_text),\n    inp_count = match_count(inpatient_keywords, c_text),\n    pwi_count = match_count(inc_keywords, c_text)\n  ) %>%\n  mutate(\n    cip_cat = case_when(\n      cip_count > 0 ~ \"Crisis Intervention Programs\"\n    ),\n    emc_cat = case_when(\n      emc_count > 0 ~ \"Emergency\"\n    ), \n      res_cat = case_when(\n        res_count > 0 ~ \"Residential Facilities\"\n    ),\n      out_cat = case_when(\n        out_count > 0 ~ \"Outpatient\"\n    ),\n      inp_cat = case_when(\n        inp_count > 0 ~ \"Inpatient\"\n    ),\n      pwi_cat = case_when(\n        pwi_count > 0 ~ \"Programs while Incarcerated\"\n    )\n  ) %>% filter(!service_name == \"Pediatric and Adult Rehabilitation Services\") %>%\n                 filter(!is.na(agency_name))\n```\n:::\n\n\n\n## Substance Use Treatment\n\n::: {.cell}\n\n```{.r .cell-code}\nsut_main <- final_cat_main %>% filter(main_categories == \"Substance Use Treatment\") %>%\n  ungroup() %>%\n  group_by(service_id) %>%\n  # Combine row values in a group\n  mutate(\n    across(\n      .cols = c(service_name, service_description),\n      .fns = ~as.list(str_split(paste(.x, collapse = \",\", sep = \"\"), \",\")[1])\n    )\n  ) %>% distinct() %>%\n  # Convert lists in each row  to strings\n  mutate(\n    across(\n      .cols = c(service_name, service_description),\n      .fns = ~list(unique(unlist(.x)))        \n    )\n  ) %>% \n  rowwise() %>% \n  # Convert lists in each row  to strings\n  mutate(\n    across(\n      .cols = c(service_name, service_description),\n      .fns = ~paste(unlist(.x), collapse = \" \")        \n    )\n  ) %>%\n  mutate(\n   agency_id,\n    c_text = paste(unlist(service_name), unlist(service_description),\n                   collapse = \" \")\n    ) %>% \n  # ungroup() %>% distinct() %>%\n  mutate(\n    hrm_count = match_count(harm_reduction_keywords, c_text),\n    out_count = match_count(outpatient_keywords, c_text) + \n      str_count(c_text, \"residential\"),\n    inp_count = match_count(inpatient_keywords, c_text),\n    sup_count = match_count(support_group_keywords, c_text)\n  ) %>%\n  mutate(\n    hrm_cat = case_when(\n      hrm_count > 0 ~ \"Harm Reduction Services\"\n    ),\n    out_cat = case_when(\n      out_count > 0 ~ \"Outpatient Treatment Programs\"\n    ), \n      inp_cat = case_when(\n        inp_count > 0 ~ \"Inpatient Rehabilitation Centers\"\n    ),\n      sup_cat = case_when(\n        sup_count > 0 ~ \"Support Groups\"\n    )\n  ) %>% \n  filter(!agency_name == \"ARCIL  Inc.\") %>%\n   filter(!service_name == \"Housing Services\") %>%\n   filter(!service_name == \"Pediatric and Adult Rehabilitation Services\") %>% \n   filter(!grepl(\"work|training|employment| prescription\", \n                 service_name, ignore.case = TRUE)) %>%\nfilter(!agency_name == \"In The Streets-Hands Up High Ministry\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwritexl::write_xlsx(bhs_main, here::here(\"data\", \"uw_categorized_behavioral_services.xlsx\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwritexl::write_xlsx(bhs_main, here::here(\"data\", \"uw_categorized_substance_abuse_treatment.xlsx\"))\n```\n:::",
    "supporting": [
      "data_cleaning_united_data_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}